<!doctype html>
<html lang="en">
    <head>    

        <title>Five useful operations with Pandas DataFrames - Francisco Correia Marques</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="google" content="notranslate" />
        <meta name="description" content="Handy tricks to explore and prepare a dataset before carrying a data analysis!"/>
        <link href="https://fonts.googleapis.com/css?family=Karla:400,400i,700,700i&display=swap" rel="stylesheet"> 
        <link rel="stylesheet" href="/assets/css/main.css">
        <link rel="apple-touch-icon" href="/apple-touch-icon.png">
        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-WWVNTWXXQE"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-WWVNTWXXQE');
        </script>
    </head>
    <body>
        
        <div id="page" class="site palette-light accent-pink">
  <header id="masthead" class="site-header outer">
  <div class="inner">
    <div class="site-header-inside">
      <div class="site-branding">
        
        
        <p class="site-title"><a href='/'>FMCM</a></p>
        
      </div><!-- .site-branding -->
      
      
      <button id="menu-open" class="menu-toggle"><span class="screen-reader-text">Close Menu</span><span class="icon-menu" aria-hidden="true"></span></button>
      <nav id="main-navigation" class="site-navigation" aria-label="Main Navigation">
        <div class="site-nav-inside">
          <button id="menu-close" class="menu-toggle"><span class="screen-reader-text">Open Menu</span><span class="icon-close" aria-hidden="true"></span></button>
          <ul class="menu">
            
              
              
              <li class="menu-item">
                
                
<a class="" href="/" >
  
  Home
  
</a>

              </li>
            
              
              
              <li class="menu-item">
                
                
<a class="" href="/blog/" >
  
  Blog
  
</a>

              </li>
            
              
              
              <li class="menu-item">
                
                
<a class="" href="/about/" >
  
  About
  
</a>

              </li>
            
          </ul><!-- .menu -->
        </div><!-- .site-nav-inside -->
      </nav><!-- .site-navigation -->
      
    </div><!-- .site-header-inside -->
  </div><!-- .inner -->
</header><!-- .site-header -->

  <main id="content" class="site-content">
    <div class="inner outer">

  <article class="post post-full">
    <header class="post-header inner-sm">
      <h1 class="post-title line-top">Five useful operations with Pandas DataFrames</h1>
      
      
      <div class="post-subtitle">
        Data science made easy!
      </div>
      
    </header>
    
    
    <div class="post-image">
      <img src="/images/post_2.jpg" alt="Five useful operations with Pandas DataFrames" />
    </div>
    
    <div class="post-content inner-sm">
      <h1 id="hello">Hello!</h1>

<p>This post will highlight five operations with <code class="highlighter-rouge">pandas DataFrames</code> that may come very handy while exploring and preparing a dataset before carrying a data analysis:</p>

<p><a href="#rename_columns">1. Renaming columns with <code class="highlighter-rouge">.rename()</code></a></p>

<p><a href="#merge_dataframes">2. Merging DataFrames with <code class="highlighter-rouge">.concat()</code></a></p>

<p><a href="#groupby_data">3. Grouping data based on a given column with <code class="highlighter-rouge">.groupby()</code></a></p>

<p><a href="#new_columns">4. Creating new columns based on existing columns with <code class="highlighter-rouge">.apply()</code></a></p>

<p><a href="#masking_df">5. Sub-selecting DataFrame rows based on binary masks</a></p>

<h1 id="what-is-pandas">What is pandas?</h1>

<p>Pandas is a Python package that provides a comprehensive set of tools to deal with tabular data. For more details on this package’s development, feel free to check the <a href="https://pandas.pydata.org/about/">pandas website</a>.</p>

<blockquote>
  <p>I see it as Microsoft Excel in Python.</p>
</blockquote>

<p>I see it as Microsoft Excel in Python and, as I learn new tricks and best practices, it has become my go-to software for any data analysis I do in my work. Hence, I will now go through five operations that I find especially useful for cleaning and organising data.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
</code></pre></div></div>

<h1 id="1-renaming-columns-with-rename"><a name="rename_columns">1. Renaming columns with <code class="highlighter-rouge">.rename()</code></a></h1>

<p>Imagine having a set of CSV files from two thermometers measuring the temperature inside the lab throughout the day. After importing both files as pandas DataFrames, thermometer A has two columns, named <code class="highlighter-rouge">time</code> and <code class="highlighter-rouge">temperature_Celsius</code>, while thermometer B also has two columns but entitled <code class="highlighter-rouge">time</code> and <code class="highlighter-rouge">temp_in_Cels</code>. In the code-cell below, we are creating the DataFrames with different column names</p>

<p>Since we know both <code class="highlighter-rouge">temperature_Celsius</code> and <code class="highlighter-rouge">temp_in_Cels</code> represent the same quantity (temperature in degrees Celsius), it would be very convenient to rename them similarly.</p>

<p>This can be achieved with the <code class="highlighter-rouge">rename()</code> DataFrame function. We only have to pass a dictionary with the key-value of the change we want to do, where <strong>keys</strong> represent <strong>current names</strong> and the <strong>values</strong> are the <strong>updated descriptions</strong>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">thermometer_A</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../input/pandas-example/thermometer_A.csv'</span><span class="p">)</span>
<span class="n">thermometer_B</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../input/pandas-example/thermometer_B.csv'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Columns of A: '</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">thermometer_A</span><span class="p">.</span><span class="n">columns</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Columns of B: '</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">thermometer_B</span><span class="p">.</span><span class="n">columns</span><span class="p">))</span>

<span class="n">rename_A</span> <span class="o">=</span> <span class="p">{</span><span class="s">'temperature_Celsius'</span><span class="p">:</span> <span class="s">'Temperature (ºC)'</span><span class="p">}</span>
<span class="n">thermometer_A</span> <span class="o">=</span> <span class="n">thermometer_A</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rename_A</span><span class="p">)</span>
<span class="n">rename_B</span> <span class="o">=</span> <span class="p">{</span><span class="s">'temp_in_Cels'</span><span class="p">:</span> <span class="s">'Temperature (ºC)'</span><span class="p">}</span>
<span class="n">thermometer_B</span> <span class="o">=</span> <span class="n">thermometer_B</span><span class="p">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">rename_B</span><span class="p">)</span>

<span class="k">print</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Updated columns of A: '</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">thermometer_A</span><span class="p">.</span><span class="n">columns</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Updated columns of B: '</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">thermometer_B</span><span class="p">.</span><span class="n">columns</span><span class="p">))</span>
</code></pre></div></div>

<p>In the example above, we renamed the columns of the DataFrames, but the same function can be used to rename the index of the DataFrame (passing the dictionary to <code class="highlighter-rouge">index=</code> instead of <code class="highlighter-rouge">columns=</code> in the function call).</p>

<h1 id="2-merging-dataframes-with-concat"><a name="merge_dataframes">2. Merging DataFrames with <code class="highlighter-rouge">.concat()</code></a></h1>

<p>Having renamed our column names, we now want to combine the DataFrames in one, containing all data from both thermometers. This is especially useful if we need to create categorical plots that highlight differences between devices.</p>

<p>First, we should create new columns on each DataFrame that uniquely describe the device. In this simple example, a column <code class="highlighter-rouge">Equipment</code> should suffice, where we fill all rows (representing different time-points) with the value <code class="highlighter-rouge">A</code> and <code class="highlighter-rouge">B</code>, respectively, for each equipment. This way, when we merge both datasets, we can still identify from which device the data came from.</p>

<p>Then, we can create our main DataFrame <code class="highlighter-rouge">temperature_measures</code>, with properly initialised columns.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">thermometer_A</span><span class="p">[</span><span class="s">'Equipment'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'A'</span>
<span class="n">thermometer_B</span><span class="p">[</span><span class="s">'Equipment'</span><span class="p">]</span> <span class="o">=</span> <span class="s">'B'</span>

<span class="n">temperature_measures</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">concat</span><span class="p">([</span><span class="n">thermometer_A</span><span class="p">,</span> <span class="n">thermometer_B</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<p>Here, we pass <code class="highlighter-rouge">axis=0</code> so that the DataFrames are combined vertically, in long-form, and <code class="highlighter-rouge">ignore_index=True</code> because, in this example, the row number is not meaningful and can be reset after concatenating the data.</p>

<p>Other pandas functions could also serve the same purpose (ex: <code class="highlighter-rouge">append()</code>). Depending on your problem, they may be more suitable.</p>

<h1 id="3-grouping-data-based-on-a-given-column-with-groupby"><a name="groupby_data">3. Grouping data based on a given column with <code class="highlighter-rouge">.groupby()</code></a></h1>

<p>Let’s assume we just want to get an average of the temperature measurements, regardless of the equipment. We can use the <code class="highlighter-rouge">.groupby()</code> function and pass the column’s name that should be used to group the data. Then, we can call further functions depending on the information we aim to compute such as <code class="highlighter-rouge">.mean()</code>, <code class="highlighter-rouge">.std()</code> (standard deviation).</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">print</span><span class="p">(</span><span class="n">temperature_measures</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'Time (h)'</span><span class="p">).</span><span class="n">mean</span><span class="p">())</span>
<span class="k">print</span><span class="p">(</span><span class="n">temperature_measures</span><span class="p">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'Time (h)'</span><span class="p">).</span><span class="n">std</span><span class="p">())</span>
</code></pre></div></div>

<h1 id="4-creating-new-columns-based-on-existing-columns-with-apply"><a name="new_columns">4. Creating new columns based on existing columns with <code class="highlighter-rouge">.apply()</code></a></h1>

<p>Let’s consider another example where we measure the growth rate of groups of plants over four weeks, comparing two groups given new fertilisers and a control group that only received water.</p>

<p>The dataset contains two columns <code class="highlighter-rouge">Baseline</code> and <code class="highlighter-rouge">Follow-up</code> representing the start and endpoint for the corresponding measurement. It could be useful for plotting purposes to have a descriptor that directly indicates the interval between measurements rather than just the start or end time-point.</p>

<p>Therefore, we can use the <code class="highlighter-rouge">.apply()</code> function to create a <code class="highlighter-rouge">lambda</code> function that operates on the provided columns.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plants_data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'../input/pandas-example/fertiliser_plant_growth.csv'</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="s">'Columns: '</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">plants_data</span><span class="p">.</span><span class="n">columns</span><span class="p">))</span>
<span class="n">plants_data</span><span class="p">[</span><span class="s">'Time-points'</span><span class="p">]</span> <span class="o">=</span> <span class="n">plants_data</span><span class="p">[[</span><span class="s">'Baseline'</span><span class="p">,</span> <span class="s">'Follow-up'</span><span class="p">]].</span><span class="nb">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">'-'</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">plants_data</span><span class="p">)</span>
</code></pre></div></div>

<p>For each row in the DataFrame (as we set <code class="highlighter-rouge">axis=1</code>), we take the values of the columns <code class="highlighter-rouge">Baseline</code> and <code class="highlighter-rouge">Follow-up</code>, convert them to <code class="highlighter-rouge">string</code> and join them with the marker <code class="highlighter-rouge">-</code>. Again, this function offers a lot more flexibility that can be tuned to your specific use-case.</p>

<h1 id="5-sub-selecting-dataframe-rows-based-on-binary-masks"><a name="masking_df">5. Sub-selecting DataFrame rows based on binary masks</a></h1>

<p>Finally, another useful technique is to mask a DataFrame based on the values of the columns. Let’s assume we want to compute some parameters for each group of plants.</p>

<p>We can create a mask based on the <code class="highlighter-rouge">Group</code> column’s values and identify the corresponding rows of the complete DataFrame. Then, we simply pass the mask in <code class="highlighter-rouge">[]</code> on the DataFrame, and the correct rows will be indexed.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mask_control</span> <span class="o">=</span> <span class="n">plants_data</span><span class="p">[</span><span class="s">'Group'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'Control'</span>
<span class="k">print</span><span class="p">(</span><span class="n">plants_data</span><span class="p">[</span><span class="n">mask_control</span><span class="p">])</span>
</code></pre></div></div>

<p>This operation also supports multiple masks simultaneously by chaining them with <code class="highlighter-rouge">&amp;</code> inside the <code class="highlighter-rouge">[]</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mask_second_follow_up</span> <span class="o">=</span> <span class="p">(</span><span class="n">plants_data</span><span class="p">[</span><span class="s">'Follow-up'</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">plants_data</span><span class="p">[</span><span class="n">mask_second_follow_up</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="n">plants_data</span><span class="p">[</span><span class="n">mask_second_follow_up</span> <span class="o">&amp;</span> <span class="n">mask_control</span><span class="p">])</span>
</code></pre></div></div>

<p>If you prefer writing the masks directly inside the <code class="highlighter-rouge">[]</code> instead of creating a mask variable, make sure to wrap each one around <code class="highlighter-rouge">()</code> to avoid errors in the logical operations.</p>

<h1 id="conclusion">Conclusion</h1>

<p><code class="highlighter-rouge">pandas</code> is a powerful package that can massively improve your workflows. Furthermore, it can be seamlessly integrated with other packages to create publication-ready figure panels (more on that later) with little effort.</p>

<p>If you would like to learn more about using pandas, I highly recommend <a href="https://jakevdp.github.io/PythonDataScienceHandbook/03.00-introduction-to-pandas.html">Chapter 3</a> of the <a href="https://jakevdp.github.io/PythonDataScienceHandbook/">Python Data Science Handbook</a> by Jake VanderPlas. The book covers all the basics with clear explanations and introduces some advanced techniques to best leverage this package in your work.</p>

<p>The data and examples shown in this post are available on <a href="https://www.kaggle.com/franciscomcm/five-useful-operations-with-pandas-dataframes">Kaggle</a>, where the outputs of each code cell are also shown.</p>

<p>Happy coding!</p>

<h3 id="acknowledgments">Acknowledgments</h3>

<p>Image by <a href="https://unsplash.com/@itookthose?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Sid Balachandran</a> on <a href="https://unsplash.com/s/photos/pandas?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></p>

    </div>
    <footer class="post-meta inner-sm">
      <time class="published" datetime="2021-01-24 00:00">January 24, 2021</time>
    </footer>
  </article><!-- .post -->

  <!-- Next/previous post navigation TBD -->
  <!--
  <nav class="read-next inner-sm">
    <h2 class="read-next-title line-top">Read Next</h2>
    <div class="post-feed grid grid-col-2">
      <article class="post grid-item">
        <div class="post-inside">
          <a class="post-thumbnail" href="#"><img src="#" alt="" /></a>
          <header class="post-header">
            <h3 class="post-title"><a href="#" rel="bookmark">Previous Post Title</a></h3>
            <div class="post-meta">
              <time class="published" datetime="">Previous post date</time>
            </div>
          </header>
        </div>
      </article>
      <article class="post grid-item">
        <div class="post-inside">
          <a class="post-thumbnail" href="#"><img src="#" alt="" /></a>
          <header class="post-header">
            <h3 class="post-title"><a href="#" rel="bookmark">Next Post Title</a></h3>
            <div class="post-meta">
              <time class="published" datetime="">Next post date</time>
            </div>
          </header>
        </div>
      </article>
    </div>
  </nav>
  -->

</div><!-- .inner -->

  </main><!-- .site-content -->
  <footer id="colophon" class="site-footer outer">
  <div class="inner">
    <div class="site-footer-inside">
      <div class="site-info">
        
        
        <span class="copyright">Francisco Correia Marques 2020 <br> <small>Theme based on Exto</small></span>
        
        
      </div><!-- .site-info -->
      
      
    </div><!-- .site-footer-inside -->
  </div><!-- .inner -->
</footer><!-- .site-footer -->

</div><!-- .site -->

        <!-- Scripts -->
        <script src="/assets/js/plugins.js"></script>
        <script src="/assets/js/main.js"></script>
    </body> 
</html>
